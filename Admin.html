<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kavency Super Market - Admin Panel</title>
    <link rel="stylesheet" href="./assets/css/admin.css">
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-lock"></i>
            </div>
            <h2 class="login-title">Admin Panel Login</h2>
            <div class="login-error" id="loginError">Invalid credentials. Please try again.</div>
            <div class="form-group">
                <input type="password" class="form-control" id="adminPassword" placeholder="Enter admin password" autocomplete="off">
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="loginAdmin()">
                <i class="fas fa-sign-in-alt"></i> Login to Admin Panel
            </button>
            <p style="margin-top: 20px; color: #666; font-size: 12px;">
                Default password: <code>kavency2023</code> (Change after first login)
            </p>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div class="admin-container" id="adminPanel">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="#" class="admin-logo">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Kavency Admin</span>
                </a>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-item active" onclick="showAdminSection('dashboard')">
                    <i class="fas fa-dashboard"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showAdminSection('products')">
                    <i class="fas fa-shopping-basket"></i>
                    <span>Products</span>
                </div>
                <div class="nav-item" onclick="showAdminSection('categories')">
                    <i class="fas fa-list"></i>
                    <span>Categories</span>
                </div>
                <div class="nav-item" onclick="showAdminSection('slides')">
                    <i class="fas fa-images"></i>
                    <span>Homepage Slides</span>
                </div>
                <div class="nav-item" onclick="showAdminSection('contacts')">
                    <i class="fas fa-envelope"></i>
                    <span>Customer Inquiries</span>
                </div>
                <div class="nav-item" onclick="showAdminSection('settings')">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="nav-item" onclick="viewWebsite()">
                    <i class="fas fa-external-link-alt"></i>
                    <span>View Website</span>
                </div>
                <div class="nav-item" onclick="logoutAdmin()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                
                <div class="admin-actions">
                    <button class="btn btn-secondary" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <div id="lastUpdated" style="font-size: 12px; color: var(--gray);">
                        Last updated: Just now
                    </div>
                </div>
            </div>
            
            <!-- Alerts -->
            <div class="alert alert-success" id="successAlert"></div>
            <div class="alert alert-error" id="errorAlert"></div>
            
            <!-- Dashboard Section -->
            <section id="dashboardSection">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: #e3f2fd; color: #1976d2;">
                            <i class="fas fa-shopping-basket"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalProducts">0</h3>
                            <p>Total Products</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: #f3e5f5; color: #7b1fa2;">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalCategories">0</h3>
                            <p>Product Categories</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: #e8f5e8; color: #388e3c;">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalSpecials">0</h3>
                            <p>Active Specials</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background-color: #fff3e0; color: #f57c00;">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalContacts">0</h3>
                            <p>Customer Inquiries</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Recent Customer Inquiries</h3>
                        <button class="btn btn-primary btn-sm" onclick="showAdminSection('contacts')">
                            View All
                        </button>
                    </div>
                    <div class="card-body">
                        <table class="table" id="recentContactsTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Subject</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Recent contacts will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Low Stock Products</h3>
                        <button class="btn btn-warning btn-sm" onclick="showAdminSection('products')">
                            Manage Products
                        </button>
                    </div>
                    <div class="card-body">
                        <table class="table" id="lowStockTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Stock</th>
                                    <th>Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Low stock products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Products Management Section -->
            <section id="productsSection" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>Product Management</h3>
                        <button class="btn btn-primary" onclick="openProductModal(null)">
                            <i class="fas fa-plus"></i> Add New Product
                        </button>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 20px;">
                            <input type="text" class="form-control" id="productSearch" placeholder="Search products..." onkeyup="searchProducts()">
                        </div>
                        <table class="table" id="productsTable">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Featured</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Categories Management Section -->
            <section id="categoriesSection" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>Category Management</h3>
                        <button class="btn btn-primary" onclick="openCategoryModal(null)">
                            <i class="fas fa-plus"></i> Add New Category
                        </button>
                    </div>
                    <div class="card-body">
                        <table class="table" id="categoriesTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Product Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Categories will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Slides Management Section -->
            <section id="slidesSection" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>Homepage Slider Management</h3>
                        <button class="btn btn-primary" onclick="openSlideModal(null)">
                            <i class="fas fa-plus"></i> Add New Slide
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="slides-list" id="slidesList">
                            <!-- Slides will be loaded here -->
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <p style="color: var(--gray);">Add up to 5 slides for the homepage slider</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Contacts Management Section -->
            <section id="contactsSection" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>Customer Inquiries</h3>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="markAllAsRead()">
                                <i class="fas fa-check-double"></i> Mark All Read
                            </button>
                            <button class="btn btn-danger" onclick="deleteAllRead()">
                                <i class="fas fa-trash"></i> Delete Read
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <table class="table" id="contactsTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Contact</th>
                                    <th>Subject</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Contacts will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Settings Section -->
            <section id="settingsSection" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>Admin Settings</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Change Admin Password</label>
                            <input type="password" class="form-control" id="newPassword" placeholder="New password">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm new password">
                        </div>
                        <button class="btn btn-primary" onclick="changePassword()">
                            <i class="fas fa-key"></i> Change Password
                        </button>
                        
                        <hr style="margin: 30px 0;">
                        
                        <div class="form-group">
                            <label class="form-label">Store Information</label>
                            <textarea class="form-control" id="storeInfo" rows="5" placeholder="Store information displayed on website"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Contact Email</label>
                            <input type="email" class="form-control" id="contactEmail" placeholder="Contact email for inquiries">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="storePhone" placeholder="Store phone number">
                        </div>
                        
                        <button class="btn btn-success" onclick="saveSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                        
                        <hr style="margin: 30px 0;">
                        
                        <div class="form-group">
                            <label class="form-label">Data Management</label>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="btn btn-secondary" onclick="exportData()">
                                    <i class="fas fa-download"></i> Export Data
                                </button>
                                <button class="btn btn-warning" onclick="importData()">
                                    <i class="fas fa-upload"></i> Import Data
                                </button>
                                <button class="btn btn-danger" onclick="resetData()">
                                    <i class="fas fa-trash"></i> Reset All Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Add New Product</h3>
                <button class="close-modal" onclick="closeProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Product Name *</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">SKU Code *</label>
                        <input type="text" class="form-control" id="productSKU" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-control" id="productCategory" required>
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Price (K) *</label>
                        <input type="number" class="form-control" id="productPrice" step="0.01" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Stock Quantity *</label>
                        <input type="number" class="form-control" id="productStock" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Discount (%)</label>
                        <input type="number" class="form-control" id="productDiscount" min="0" max="100" step="1">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Weight (kg)</label>
                        <input type="number" class="form-control" id="productWeight" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Featured Product</label>
                        <select class="form-control" id="productFeatured">
                            <option value="no">No</option>
                            <option value="yes">Yes</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Product Image</label>
                    <div class="image-upload-container" onclick="document.getElementById('productImageFile').click()">
                        <div class="image-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p>Click to upload product image</p>
                        <p style="font-size: 12px; color: var(--gray); margin-top: 5px;">Recommended size: 600x600px</p>
                        <input type="file" class="file-input" id="productImageFile" accept="image/*" onchange="previewProductImage(event)">
                    </div>
                    <div class="image-preview" id="productImagePreview">
                        <img id="productPreviewImage" src="" alt="Preview">
                    </div>
                    <input type="hidden" id="productImageData">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description *</label>
                    <textarea class="form-control" id="productDescription" rows="3" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeProductModal()">Cancel</button>
                <button class="btn btn-primary" id="productModalSave" onclick="saveProduct()">Save Product</button>
            </div>
        </div>
    </div>
    
    <!-- Category Modal -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="categoryModalTitle">Add New Category</h3>
                <button class="close-modal" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category Name *</label>
                        <input type="text" class="form-control" id="categoryName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category ID *</label>
                        <input type="text" class="form-control" id="categoryId" required>
                        <small style="color: var(--gray); margin-top: 5px; display: block;">
                            Use format: cat1, cat2, etc.
                        </small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="categoryDescription" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Product Count</label>
                    <input type="number" class="form-control" id="categoryCount" value="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCategoryModal()">Cancel</button>
                <button class="btn btn-primary" id="categoryModalSave" onclick="saveCategory()">Save Category</button>
            </div>
        </div>
    </div>
    
    <!-- Slide Modal -->
    <div class="modal" id="slideModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="slideModalTitle">Add New Slide</h3>
                <button class="close-modal" onclick="closeSlideModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Slide Title *</label>
                    <input type="text" class="form-control" id="slideTitle" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Slide Description *</label>
                    <textarea class="form-control" id="slideDescription" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Slide Image *</label>
                    <div class="image-upload-container" onclick="document.getElementById('slideImageFile').click()">
                        <div class="image-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <p>Click to upload slide image</p>
                        <p style="font-size: 12px; color: var(--gray); margin-top: 5px;">Recommended size: 1600x500px</p>
                        <input type="file" class="file-input" id="slideImageFile" accept="image/*" onchange="previewSlideImage(event)">
                    </div>
                    <div class="image-preview" id="slideImagePreview">
                        <img id="slidePreviewImage" src="" alt="Preview">
                    </div>
                    <input type="hidden" id="slideImageData">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Slide Status</label>
                    <select class="form-control" id="slideActive">
                        <option value="true">Active</option>
                        <option value="false">Inactive</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSlideModal()">Cancel</button>
                <button class="btn btn-primary" id="slideModalSave" onclick="saveSlide()">Save Slide</button>
            </div>
        </div>
    </div>
    
    <!-- Contact View Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Customer Inquiry</h3>
                <button class="close-modal" onclick="closeContactModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control" id="viewContactName" readonly>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="text" class="form-control" id="viewContactEmail" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="text" class="form-control" id="viewContactPhone" readonly>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Subject</label>
                    <input type="text" class="form-control" id="viewContactSubject" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Message</label>
                    <textarea class="form-control" id="viewContactMessage" rows="5" readonly></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Date Submitted</label>
                        <input type="text" class="form-control" id="viewContactDate" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <input type="text" class="form-control" id="viewContactStatus" readonly>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeContactModal()">Close</button>
                <button class="btn btn-success" id="replyContactBtn" onclick="replyToContact()">
                    <i class="fas fa-reply"></i> Reply via Email
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let adminPassword = localStorage.getItem('kavency_admin_password') || 'kavency2023';
        let isLoggedIn = false;
        let currentAdminSection = 'dashboard';
        let editingProductId = null;
        let editingCategoryId = null;
        let editingSlideId = null;
        let editingContactId = null;
        let imageBase64 = null;
        let slideImageBase64 = null;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminSession();
        });

        // ==================== AUTHENTICATION FUNCTIONS ====================
        function checkAdminSession() {
            const session = sessionStorage.getItem('kavency_admin_session');
            if (session === 'true') {
                isLoggedIn = true;
                showAdminPanel();
            } else {
                showLoginScreen();
            }
        }

        function loginAdmin() {
            const passwordInput = document.getElementById('adminPassword');
            const password = passwordInput.value.trim();
            
            if (password === adminPassword) {
                sessionStorage.setItem('kavency_admin_session', 'true');
                isLoggedIn = true;
                showAdminPanel();
                showAlert('Login successful!', 'success');
            } else {
                document.getElementById('loginError').style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        function logoutAdmin() {
            sessionStorage.removeItem('kavency_admin_session');
            isLoggedIn = false;
            showLoginScreen();
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
        }

        function showAdminPanel() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            loadDashboardData();
            showAdminSection('dashboard');
        }

        // ==================== NAVIGATION FUNCTIONS ====================
        function showAdminSection(sectionId) {
            // Hide all sections
            const sections = ['dashboard', 'products', 'categories', 'slides', 'contacts', 'settings'];
            sections.forEach(id => {
                const section = document.getElementById(id + 'Section');
                if (section) section.style.display = 'none';
            });
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionId + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Update active nav item
            const navItem = document.querySelector(`.nav-item[onclick*="${sectionId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'products': 'Product Management',
                'categories': 'Category Management',
                'slides': 'Homepage Slider Management',
                'contacts': 'Customer Inquiries',
                'settings': 'Admin Settings'
            };
            document.getElementById('pageTitle').textContent = titles[sectionId] || 'Dashboard';
            
            currentAdminSection = sectionId;
            
            // Load section data
            switch(sectionId) {
                case 'products':
                    loadProductsTable();
                    break;
                case 'categories':
                    loadCategoriesTable();
                    break;
                case 'slides':
                    loadSlidesList();
                    break;
                case 'contacts':
                    loadContactsTable();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        function viewWebsite() {
            window.open('index.html', '_blank');
        }

        // ==================== IMAGE UPLOAD FUNCTIONS ====================
        function previewProductImage(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                imageBase64 = e.target.result;
                const preview = document.getElementById('productImagePreview');
                const previewImg = document.getElementById('productPreviewImage');
                previewImg.src = imageBase64;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        function previewSlideImage(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                slideImageBase64 = e.target.result;
                const preview = document.getElementById('slideImagePreview');
                const previewImg = document.getElementById('slidePreviewImage');
                previewImg.src = slideImageBase64;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        // ==================== DASHBOARD FUNCTIONS ====================
        function loadDashboardData() {
            // Load products
            const products = JSON.parse(localStorage.getItem('kavency_products')) || [];
            document.getElementById('totalProducts').textContent = products.length;
            
            // Load categories
            const categories = JSON.parse(localStorage.getItem('kavency_categories')) || [];
            document.getElementById('totalCategories').textContent = categories.length;
            
            // Load specials (products with discount)
            const specials = products.filter(p => p.discount > 0);
            document.getElementById('totalSpecials').textContent = specials.length;
            
            // Load contacts
            const contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
            document.getElementById('totalContacts').textContent = contacts.length;
            
            // Load recent contacts
            loadRecentContacts();
            
            // Load low stock products
            loadLowStockProducts();
            
            updateLastUpdatedTime();
        }

        function loadRecentContacts() {
            const contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
            const recentContacts = contacts.slice(-5).reverse();
            
            const tableBody = document.querySelector('#recentContactsTable tbody');
            tableBody.innerHTML = '';
            
            recentContacts.forEach(contact => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${contact.name}</td>
                    <td>${contact.email}</td>
                    <td>${contact.subject}</td>
                    <td>${formatDate(contact.date)}</td>
                    <td><span class="status-badge status-${contact.status}">${contact.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewContact('${contact.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadLowStockProducts() {
            const products = JSON.parse(localStorage.getItem('kavency_products')) || [];
            const lowStockProducts = products.filter(p => p.stock < 10);
            
            const tableBody = document.querySelector('#lowStockTable tbody');
            tableBody.innerHTML = '';
            
            lowStockProducts.forEach(product => {
                const category = getCategoryName(product.category);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${category}</td>
                    <td><span style="color: ${product.stock < 5 ? 'var(--danger)' : 'var(--warning)'};">${product.stock}</span></td>
                    <td>K${product.price.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editProduct('${product.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function refreshData() {
            loadDashboardData();
            showAlert('Data refreshed successfully!', 'success');
        }

        // ==================== PRODUCT MANAGEMENT FUNCTIONS ====================
        function loadProductsTable() {
            const products = JSON.parse(localStorage.getItem('kavency_products')) || [];
            const categories = JSON.parse(localStorage.getItem('kavency_categories')) || [];
            
            const tableBody = document.querySelector('#productsTable tbody');
            tableBody.innerHTML = '';
            
            products.forEach(product => {
                const category = categories.find(c => c.id === product.category) || { name: 'Uncategorized' };
                const stockClass = product.stock < 5 ? 'danger' : product.stock < 10 ? 'warning' : 'success';
                const stockText = product.stock < 5 ? 'Low' : product.stock < 10 ? 'Medium' : 'Good';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <img src="${product.image}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                    </td>
                    <td>${product.name}</td>
                    <td>${category.name}</td>
                    <td>K${product.price.toFixed(2)}</td>
                    <td>
                        <span class="status-badge" style="background-color: ${stockClass === 'danger' ? '#f8d7da' : stockClass === 'warning' ? '#fff3cd' : '#d4edda'}; color: ${stockClass === 'danger' ? '#721c24' : stockClass === 'warning' ? '#856404' : '#155724'};">${stockText} (${product.stock})</span>
                    </td>
                    <td>${product.featured === 'yes' ? '<i class="fas fa-star" style="color: var(--secondary);"></i>' : '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="editProduct('${product.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#productsTable tbody tr');
            
            rows.forEach(row => {
                const productName = row.cells[1].textContent.toLowerCase();
                row.style.display = productName.includes(searchTerm) ? '' : 'none';
            });
        }

        function openProductModal(productId) {
            editingProductId = productId;
            const modal = document.getElementById('productModal');
            const categories = JSON.parse(localStorage.getItem('kavency_categories')) || [];
            
            // Populate category dropdown
            const categorySelect = document.getElementById('productCategory');
            categorySelect.innerHTML = '<option value="">Select Category</option>';
            categories.forEach(category => {
                categorySelect.innerHTML += `<option value="${category.id}">${category.name}</option>`;
            });
            
            // Reset image preview
            imageBase64 = null;
            document.getElementById('productImagePreview').style.display = 'none';
            document.getElementById('productImageFile').value = '';
            
            if (productId) {
                // Edit mode
                document.getElementById('productModalTitle').textContent = 'Edit Product';
                document.getElementById('productModalSave').textContent = 'Update Product';
                
                const products = JSON.parse(localStorage.getItem('kavency_products')) || [];
                const product = products.find(p => p.id === productId);
                
                if (product) {
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productSKU').value = product.sku;
                    document.getElementById('productCategory').value = product.category;
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productStock').value = product.stock;
                    document.getElementById('productDiscount').value = product.discount || 0;
                    document.getElementById('productWeight').value = product.weight || '';
                    document.getElementById('productFeatured').value = product.featured || 'no';
                    document.getElementById('productDescription').value = product.description;
                    
                    // Set image preview if image exists
                    if (product.image && product.image.startsWith('data:')) {
                        imageBase64 = product.image;
                        const preview = document.getElementById('productImagePreview');
                        const previewImg = document.getElementById('productPreviewImage');
                        previewImg.src = imageBase64;
                        preview.style.display = 'block';
                    }
                }
            } else {
                // Add mode
                document.getElementById('productModalTitle').textContent = 'Add New Product';
                document.getElementById('productModalSave').textContent = 'Save Product';
                
                // Clear form
                document.getElementById('productName').value = '';
                document.getElementById('productSKU').value = '';
                document.getElementById('productCategory').value = '';
                document.getElementById('productPrice').value = '';
                document.getElementById('productStock').value = '';
                document.getElementById('productDiscount').value = 0;
                document.getElementById('productWeight').value = '';
                document.getElementById('productFeatured').value = 'no';
                document.getElementById('productDescription').value = '';
            }
            
            modal.style.display = 'flex';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
            editingProductId = null;
            imageBase64 = null;
        }

        function saveProduct() {
            const name = document.getElementById('productName').value.trim();
            const sku = document.getElementById('productSKU').value.trim();
            const category = document.getElementById('productCategory').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const discount = parseInt(document.getElementById('productDiscount').value) || 0;
            const weight = parseFloat(document.getElementById('productWeight').value) || 0;
            const featured = document.getElementById('productFeatured').value;
            const description = document.getElementById('productDescription').value.trim();
            
            // Validation
            if (!name || !sku || !category || !price || !stock || !description) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }
            
            // Use uploaded image or keep existing image
            let image = imageBase64 || 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80';
            
            // If editing and no new image uploaded, keep existing image
            if (editingProductId && !imageBase64) {
                const products = JSON.parse(localStorage.getItem('kavency_products')) || [];
                const existingProduct = products.find(p => p.id === editingProductId);
                if (existingProduct) {
                    image = existingProduct.image;
                }
            }
            
            let products = JSON.parse(localStorage.getItem('kavency_products')) || [];
            
            if (editingProductId) {
                // Update existing product
                const index = products.findIndex(p => p.id === editingProductId);
                if (index !== -1) {
                    products[index] = {
                        ...products[index],
                        name,
                        sku,
                        category,
                        price,
                        stock,
                        discount,
                        weight,
                        featured,
                        image,
                        description
                    };
                }
            } else {
                // Add new product
                const newId = 'P' + String(products.length + 1).padStart(3, '0');
                products.push({
                    id: newId,
                    name,
                    sku,
                    category,
                    price,
                    stock,
                    discount,
                    weight,
                    featured,
                    image,
                    description
                });
            }
            
            localStorage.setItem('kavency_products', JSON.stringify(products));
            closeProductModal();
            loadProductsTable();
            loadDashboardData();
            showAlert(`Product ${editingProductId ? 'updated' : 'added'} successfully!`, 'success');
            
            // Update main website
            localStorage.setItem('kavency_store_updated', new Date().toISOString());
        }

        function editProduct(productId) {
            openProductModal(productId);
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                let products = JSON.parse(localStorage.getItem('kavency_products')) || [];
                products = products.filter(p => p.id !== productId);
                localStorage.setItem('kavency_products', JSON.stringify(products));
                
                loadProductsTable();
                loadDashboardData();
                showAlert('Product deleted successfully!', 'success');
                
                // Update main website
                localStorage.setItem('kavency_store_updated', new Date().toISOString());
            }
        }

        // ==================== CATEGORY MANAGEMENT FUNCTIONS ====================
        function loadCategoriesTable() {
            const categories = JSON.parse(localStorage.getItem('kavency_categories')) || [];
            const products = JSON.parse(localStorage.getItem('kavency_products')) || [];
            
            const tableBody = document.querySelector('#categoriesTable tbody');
            tableBody.innerHTML = '';
            
            categories.forEach(category => {
                const productCount = products.filter(p => p.category === category.id).length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${category.id}</td>
                    <td>${category.name}</td>
                    <td>${category.description || '-'}</td>
                    <td>${productCount}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="editCategory('${category.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCategory('${category.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function openCategoryModal(categoryId) {
            editingCategoryId = categoryId;
            const modal = document.getElementById('categoryModal');
            
            if (categoryId) {
                // Edit mode
                document.getElementById('categoryModalTitle').textContent = 'Edit Category';
                document.getElementById('categoryModalSave').textContent = 'Update Category';
                
                const categories = JSON.parse(localStorage.getItem('kavency_categories')) || [];
                const category = categories.find(c => c.id === categoryId);
                
                if (category) {
                    document.getElementById('categoryName').value = category.name;
                    document.getElementById('categoryId').value = category.id;
                    document.getElementById('categoryId').readOnly = true;
                    document.getElementById('categoryDescription').value = category.description || '';
                    document.getElementById('categoryCount').value = category.productCount || 0;
                }
            } else {
                // Add mode
                document.getElementById('categoryModalTitle').textContent = 'Add New Category';
                document.getElementById('categoryModalSave').textContent = 'Save Category';
                document.getElementById('categoryId').readOnly = false;
                
                // Clear form
                document.getElementById('categoryName').value = '';
                document.getElementById('categoryId').value = '';
                document.getElementById('categoryDescription').value = '';
                document.getElementById('categoryCount').value = 0;
            }
            
            modal.style.display = 'flex';
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
            editingCategoryId = null;
        }

        function saveCategory() {
            const name = document.getElementById('categoryName').value.trim();
            const id = document.getElementById('categoryId').value.trim();
            const description = document.getElementById('categoryDescription').value.trim();
            const count = parseInt(document.getElementById('categoryCount').value) || 0;
            
            // Validation
            if (!name || !id) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }
            
            let categories = JSON.parse(localStorage.getItem('kavency_categories')) || [];
            
            if (editingCategoryId) {
                // Update existing category
                const index = categories.findIndex(c => c.id === editingCategoryId);
                if (index !== -1) {
                    categories[index] = {
                        ...categories[index],
                        name,
                        description,
                        productCount: count
                    };
                }
            } else {
                // Check if ID already exists
                if (categories.find(c => c.id === id)) {
                    showAlert('Category ID already exists. Please use a different ID.', 'error');
                    return;
                }
                
                // Add new category
                categories.push({
                    id,
                    name,
                    description,
                    productCount: count
                });
            }
            
            localStorage.setItem('kavency_categories', JSON.stringify(categories));
            closeCategoryModal();
            loadCategoriesTable();
            loadDashboardData();
            showAlert(`Category ${editingCategoryId ? 'updated' : 'added'} successfully!`, 'success');
            
            // Update main website
            localStorage.setItem('kavency_store_updated', new Date().toISOString());
        }

        function editCategory(categoryId) {
            openCategoryModal(categoryId);
        }

        function deleteCategory(categoryId) {
            if (confirm('Are you sure you want to delete this category? Products in this category will become uncategorized.')) {
                let categories = JSON.parse(localStorage.getItem('kavency_categories')) || [];
                categories = categories.filter(c => c.id !== categoryId);
                localStorage.setItem('kavency_categories', JSON.stringify(categories));
                
                loadCategoriesTable();
                loadDashboardData();
                showAlert('Category deleted successfully!', 'success');
                
                // Update main website
                localStorage.setItem('kavency_store_updated', new Date().toISOString());
            }
        }

        // ==================== SLIDES MANAGEMENT FUNCTIONS ====================
        function loadSlidesList() {
            const slides = JSON.parse(localStorage.getItem('kavency_slides')) || [];
            const list = document.getElementById('slidesList');
            
            if (!list) return;
            
            list.innerHTML = '';
            
            slides.forEach(slide => {
                const slideItem = document.createElement('div');
                slideItem.className = 'slide-item';
                slideItem.innerHTML = `
                    <div class="slide-image">
                        <img src="${slide.image}" alt="${slide.title}">
                    </div>
                    <div class="slide-info">
                        <h4 style="margin-bottom: 5px;">${slide.title}</h4>
                        <p style="color: var(--gray); margin-bottom: 10px;">${slide.description}</p>
                        <span class="status-badge" style="background-color: ${slide.active ? '#d4edda' : '#f8d7da'}; color: ${slide.active ? '#155724' : '#721c24'}">
                            ${slide.active ? 'Active' : 'Inactive'}
                        </span>
                    </div>
                    <div class="slide-actions">
                        <button class="btn btn-sm btn-primary" onclick="editSlide('${slide.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSlide('${slide.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(slideItem);
            });
        }

        function openSlideModal(slideId) {
            editingSlideId = slideId;
            const modal = document.getElementById('slideModal');
            
            // Reset image preview
            slideImageBase64 = null;
            document.getElementById('slideImagePreview').style.display = 'none';
            document.getElementById('slideImageFile').value = '';
            
            if (slideId) {
                // Edit mode
                document.getElementById('slideModalTitle').textContent = 'Edit Slide';
                document.getElementById('slideModalSave').textContent = 'Update Slide';
                
                const slides = JSON.parse(localStorage.getItem('kavency_slides')) || [];
                const slide = slides.find(s => s.id === slideId);
                
                if (slide) {
                    document.getElementById('slideTitle').value = slide.title;
                    document.getElementById('slideDescription').value = slide.description;
                    document.getElementById('slideActive').value = slide.active;
                    
                    // Set image preview
                    if (slide.image) {
                        slideImageBase64 = slide.image;
                        const preview = document.getElementById('slideImagePreview');
                        const previewImg = document.getElementById('slidePreviewImage');
                        previewImg.src = slideImageBase64;
                        preview.style.display = 'block';
                    }
                }
            } else {
                // Add mode - check if we can add more slides
                const slides = JSON.parse(localStorage.getItem('kavency_slides')) || [];
                if (slides.length >= 5) {
                    showAlert('Maximum 5 slides allowed. Please delete a slide first.', 'error');
                    return;
                }
                
                document.getElementById('slideModalTitle').textContent = 'Add New Slide';
                document.getElementById('slideModalSave').textContent = 'Save Slide';
                
                // Clear form
                document.getElementById('slideTitle').value = '';
                document.getElementById('slideDescription').value = '';
                document.getElementById('slideActive').value = 'true';
            }
            
            modal.style.display = 'flex';
        }

        function closeSlideModal() {
            document.getElementById('slideModal').style.display = 'none';
            editingSlideId = null;
            slideImageBase64 = null;
        }

        function saveSlide() {
            const title = document.getElementById('slideTitle').value.trim();
            const description = document.getElementById('slideDescription').value.trim();
            const active = document.getElementById('slideActive').value === 'true';
            
            // Validation
            if (!title || !description) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }
            
            // Use uploaded image or keep existing image
            let image = slideImageBase64;
            
            // If editing and no new image uploaded, keep existing image
            if (editingSlideId && !slideImageBase64) {
                const slides = JSON.parse(localStorage.getItem('kavency_slides')) || [];
                const existingSlide = slides.find(s => s.id === editingSlideId);
                if (existingSlide) {
                    image = existingSlide.image;
                }
            }
            
            // If no image (for new slide), use default
            if (!image) {
                image = 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80';
            }
            
            let slides = JSON.parse(localStorage.getItem('kavency_slides')) || [];
            
            if (editingSlideId) {
                // Update existing slide
                const index = slides.findIndex(s => s.id === editingSlideId);
                if (index !== -1) {
                    slides[index] = {
                        ...slides[index],
                        title,
                        description,
                        image,
                        active
                    };
                }
            } else {
                // Add new slide
                const newId = 'slide' + (slides.length + 1);
                slides.push({
                    id: newId,
                    title,
                    description,
                    image,
                    active
                });
            }
            
            localStorage.setItem('kavency_slides', JSON.stringify(slides));
            closeSlideModal();
            loadSlidesList();
            showAlert(`Slide ${editingSlideId ? 'updated' : 'added'} successfully!`, 'success');
            
            // Update main website
            localStorage.setItem('kavency_store_updated', new Date().toISOString());
        }

        function editSlide(slideId) {
            openSlideModal(slideId);
        }

        function deleteSlide(slideId) {
            if (confirm('Are you sure you want to delete this slide?')) {
                let slides = JSON.parse(localStorage.getItem('kavency_slides')) || [];
                slides = slides.filter(s => s.id !== slideId);
                localStorage.setItem('kavency_slides', JSON.stringify(slides));
                
                loadSlidesList();
                showAlert('Slide deleted successfully!', 'success');
                
                // Update main website
                localStorage.setItem('kavency_store_updated', new Date().toISOString());
            }
        }

        // ==================== CONTACT MANAGEMENT FUNCTIONS ====================
        function loadContactsTable() {
            const contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
            
            const tableBody = document.querySelector('#contactsTable tbody');
            tableBody.innerHTML = '';
            
            // Sort by date (newest first)
            contacts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            contacts.forEach(contact => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${contact.name}</td>
                    <td>
                        <div>${contact.email}</div>
                        <small>${contact.phone || 'No phone'}</small>
                    </td>
                    <td>${contact.subject}</td>
                    <td>${formatDate(contact.date)}</td>
                    <td><span class="status-badge status-${contact.status}">${contact.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="viewContact('${contact.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-success" onclick="markAsRead('${contact.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteContact('${contact.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function viewContact(contactId) {
            editingContactId = contactId;
            const modal = document.getElementById('contactModal');
            const contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
            const contact = contacts.find(c => c.id === contactId);
            
            if (contact) {
                document.getElementById('viewContactName').value = contact.name;
                document.getElementById('viewContactEmail').value = contact.email;
                document.getElementById('viewContactPhone').value = contact.phone || 'Not provided';
                document.getElementById('viewContactSubject').value = contact.subject;
                document.getElementById('viewContactMessage').value = contact.message;
                document.getElementById('viewContactDate').value = formatDate(contact.date);
                document.getElementById('viewContactStatus').value = contact.status;
                
                // Mark as read when viewing
                if (contact.status === 'unread') {
                    markAsRead(contactId, false);
                }
            }
            
            modal.style.display = 'flex';
        }

        function closeContactModal() {
            document.getElementById('contactModal').style.display = 'none';
            editingContactId = null;
        }

        function markAsRead(contactId, showAlert = true) {
            let contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
            const index = contacts.findIndex(c => c.id === contactId);
            
            if (index !== -1) {
                contacts[index].status = 'read';
                localStorage.setItem('kavency_contacts', JSON.stringify(contacts));
                
                loadContactsTable();
                loadRecentContacts();
                
                if (showAlert) {
                    showAlert('Marked as read!', 'success');
                }
            }
        }

        function markAllAsRead() {
            let contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
            contacts = contacts.map(contact => ({ ...contact, status: 'read' }));
            localStorage.setItem('kavency_contacts', JSON.stringify(contacts));
            
            loadContactsTable();
            loadRecentContacts();
            showAlert('All inquiries marked as read!', 'success');
        }

        function deleteContact(contactId) {
            if (confirm('Are you sure you want to delete this inquiry?')) {
                let contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
                contacts = contacts.filter(c => c.id !== contactId);
                localStorage.setItem('kavency_contacts', JSON.stringify(contacts));
                
                loadContactsTable();
                loadRecentContacts();
                showAlert('Inquiry deleted successfully!', 'success');
            }
        }

        function deleteAllRead() {
            if (confirm('Are you sure you want to delete all read inquiries?')) {
                let contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
                contacts = contacts.filter(c => c.status !== 'read');
                localStorage.setItem('kavency_contacts', JSON.stringify(contacts));
                
                loadContactsTable();
                loadRecentContacts();
                showAlert('All read inquiries deleted!', 'success');
            }
        }

        function replyToContact() {
            const contacts = JSON.parse(localStorage.getItem('kavency_contacts')) || [];
            const contact = contacts.find(c => c.id === editingContactId);
            
            if (contact) {
                // Create mailto link
                const subject = `Re: ${contact.subject}`;
                const body = `Dear ${contact.name},\n\nThank you for your inquiry regarding "${contact.subject}".\n\n`;
                const mailtoLink = `mailto:${contact.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                // Update status to replied
                const index = contacts.findIndex(c => c.id === editingContactId);
                if (index !== -1) {
                    contacts[index].status = 'replied';
                    localStorage.setItem('kavency_contacts', JSON.stringify(contacts));
                }
                
                // Open email client
                window.location.href = mailtoLink;
                
                // Reload tables
                loadContactsTable();
                loadRecentContacts();
                
                showAlert('Email client opened for reply!', 'success');
            }
        }

        // ==================== SETTINGS FUNCTIONS ====================
        function loadSettings() {
            // Load current password
            const currentPassword = localStorage.getItem('kavency_admin_password') || 'kavency2023';
            adminPassword = currentPassword;
            
            // Load other settings
            const storeInfo = localStorage.getItem('kavency_store_info') || '';
            const contactEmail = localStorage.getItem('kavency_contact_email') || '';
            const storePhone = localStorage.getItem('kavency_store_phone') || '';
            
            document.getElementById('storeInfo').value = storeInfo;
            document.getElementById('contactEmail').value = contactEmail;
            document.getElementById('storePhone').value = storePhone;
        }

        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!newPassword) {
                showAlert('Please enter a new password', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('Passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showAlert('Password must be at least 6 characters', 'error');
                return;
            }
            
            localStorage.setItem('kavency_admin_password', newPassword);
            adminPassword = newPassword;
            
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            showAlert('Password changed successfully!', 'success');
        }

        function saveSettings() {
            const storeInfo = document.getElementById('storeInfo').value;
            const contactEmail = document.getElementById('contactEmail').value;
            const storePhone = document.getElementById('storePhone').value;
            
            localStorage.setItem('kavency_store_info', storeInfo);
            localStorage.setItem('kavency_contact_email', contactEmail);
            localStorage.setItem('kavency_store_phone', storePhone);
            
            showAlert('Settings saved successfully!', 'success');
        }

        function exportData() {
            const data = {
                products: JSON.parse(localStorage.getItem('kavency_products')) || [],
                categories: JSON.parse(localStorage.getItem('kavency_categories')) || [],
                slides: JSON.parse(localStorage.getItem('kavency_slides')) || [],
                contacts: JSON.parse(localStorage.getItem('kavency_contacts')) || [],
                settings: {
                    storeInfo: localStorage.getItem('kavency_store_info') || '',
                    contactEmail: localStorage.getItem('kavency_contact_email') || '',
                    storePhone: localStorage.getItem('kavency_store_phone') || '',
                    adminPassword: localStorage.getItem('kavency_admin_password') || 'kavency2023'
                }
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `kavency-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            
            showAlert('Data exported successfully!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('Importing data will overwrite existing data. Are you sure?')) {
                            if (data.products) localStorage.setItem('kavency_products', JSON.stringify(data.products));
                            if (data.categories) localStorage.setItem('kavency_categories', JSON.stringify(data.categories));
                            if (data.slides) localStorage.setItem('kavency_slides', JSON.stringify(data.slides));
                            if (data.contacts) localStorage.setItem('kavency_contacts', JSON.stringify(data.contacts));
                            
                            if (data.settings) {
                                if (data.settings.storeInfo) localStorage.setItem('kavency_store_info', data.settings.storeInfo);
                                if (data.settings.contactEmail) localStorage.setItem('kavency_contact_email', data.settings.contactEmail);
                                if (data.settings.storePhone) localStorage.setItem('kavency_store_phone', data.settings.storePhone);
                                if (data.settings.adminPassword) localStorage.setItem('kavency_admin_password', data.settings.adminPassword);
                            }
                            
                            loadDashboardData();
                            showAlert('Data imported successfully!', 'success');
                        }
                    } catch (error) {
                        showAlert('Error importing data. Invalid file format.', 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetData() {
            if (confirm('WARNING: This will reset ALL data to default values. Are you absolutely sure?')) {
                if (confirm('This action cannot be undone. Type "RESET" to confirm:')) {
                    // Clear all data except admin password
                    const currentPassword = localStorage.getItem('kavency_admin_password') || 'kavency2023';
                    
                    localStorage.removeItem('kavency_products');
                    localStorage.removeItem('kavency_categories');
                    localStorage.removeItem('kavency_slides');
                    localStorage.removeItem('kavency_contacts');
                    localStorage.removeItem('kavency_store_info');
                    localStorage.removeItem('kavency_contact_email');
                    localStorage.removeItem('kavency_store_phone');
                    
                    // Restore admin password
                    localStorage.setItem('kavency_admin_password', currentPassword);
                    adminPassword = currentPassword;
                    
                    // Reload dashboard
                    loadDashboardData();
                    
                    showAlert('Data reset completed!', 'success');
                }
            }
        }

        // ==================== UTILITY FUNCTIONS ====================
        function getCategoryName(categoryId) {
            const categories = JSON.parse(localStorage.getItem('kavency_categories')) || [];
            const category = categories.find(c => c.id === categoryId);
            return category ? category.name : 'Uncategorized';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function showAlert(message, type) {
            const alertDiv = document.getElementById(type + 'Alert');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }

        function updateLastUpdatedTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('lastUpdated').textContent = `Last updated: ${timeString}`;
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });
    </script>
</body>
</html>